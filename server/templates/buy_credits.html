<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Credits - IceCream</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/logo/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css') }}">

    <style>
        .bg-primary {
            background-color: rgb(27, 144, 173);
        }

        .navbar-logo img {
            width: 70px !important;
        }

        @media only screen and (max-width: 768px) {
            .navbar-logo img {
                width: 45px !important;
            }
        }

        .form-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            max-width: 500px;
            margin: auto;
        }

        .form-container h1 {
            font-size: 2rem;
            color: rgb(27, 144, 173);
            font-weight: bold;
        }

        .form-container p {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 20px;
        }

        .form-container input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-container button {
            background-color: rgb(27, 144, 173);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .form-container button:hover {
            background-color: rgb(22, 118, 141);
        }
    </style>

    <script src="/static/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>
</head>

<body>
    <!-- Header Section -->
    <div class="ud-header absolute left-0 top-0 z-40 flex w-full items-center bg-transparent">
        <div class="container">
            <div class="relative -mx-4 flex items-center justify-between">
                <div class="w-60 max-w-full px-4">
                    <a href="/" class="navbar-logo block w-full py-5">
                        <img src="/static/images/logo/logo.png" alt="logo" class="header-logo w-full" />
                    </a>
                </div>
                <div class="flex w-full items-center justify-between px-4">
                    <div>
                        <button id="navbarToggler"
                            class="absolute right-4 top-1/2 block -translate-y-1/2 rounded-lg px-3 py-[6px] ring-primary focus:ring-2 lg:hidden">
                            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
                            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
                            <span class="relative my-[6px] block h-[2px] w-[30px] bg-white"></span>
                        </button>
                        <nav id="navbarCollapse"
                            class="absolute right-4 top-full hidden w-full max-w-[250px] rounded-lg bg-white py-5 shadow-lg dark:bg-dark-2 lg:static lg:block lg:w-full lg:max-w-full lg:bg-transparent lg:px-4 lg:py-0 lg:shadow-none dark:lg:bg-transparent xl:px-6">
                            <ul class="blcok lg:flex 2xl:ml-20">
                                <li class="group relative">
                                    <a href="/"
                                        class="ud-menu-scroll mx-8 flex py-2 text-base font-medium text-dark group-hover:text-primary dark:text-white lg:mr-0 lg:inline-flex lg:px-0 lg:py-6 lg:text-white lg:group-hover:text-white lg:group-hover:opacity-70">
                                        Home
                                    </a>
                                </li>
                                <li class="group relative">
                                    <a href="/#features"
                                        class="ud-menu-scroll mx-8 flex py-2 text-base font-medium text-dark group-hover:text-primary dark:text-white lg:ml-7 lg:mr-0 lg:inline-flex lg:px-0 lg:py-6 lg:text-white lg:group-hover:text-white lg:group-hover:opacity-70 xl:ml-10">
                                        Features
                                    </a>
                                </li>
                                <li class="group relative">
                                    <a href="/#pricing"
                                        class="ud-menu-scroll mx-8 flex py-2 text-base font-medium text-dark group-hover:text-primary dark:text-white lg:ml-7 lg:mr-0 lg:inline-flex lg:px-0 lg:py-6 lg:text-white lg:group-hover:text-white lg:group-hover:opacity-70 xl:ml-10">
                                        Pricing
                                    </a>
                                </li>

                            </ul>
                        </nav>
                    </div>
                    <div class="flex items-center justify-end pr-16 lg:pr-0">
                        <div class="hidden sm:flex">
                            <a href="https://www.youtube.com"
                                class="loginBtn px-[22px] py-2 text-base font-medium text-white hover:opacity-70">
                                Watch Video
                            </a>
                            <a href="https://chromewebstore.google.com/detail/icecream/gkngkecaijfnpadgeepjapabhkpikhdl"
                                class="signUpBtn rounded-md bg-white bg-opacity-20 px-6 py-2 text-base font-medium text-white duration-300 ease-in-out hover:bg-opacity-100 hover:text-dark">
                                ⚡ Install Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Buy Credits Section -->
    <div id="home"
        class="relative overflow-hidden bg-primary pt-[120px] md:pt-[130px] lg:pt-[160px] mb-[20px] md:mb-[30px] lg:mb-[40px]">
        <div class="container">
            <div class="bg-primary py-20">
                <div class="form-container">
                    <h1>Buy Credits</h1>
                    <p>100 Credits (₹10)</p>
                    <form id="paymentForm">
                        <input type="email" name="email" placeholder="Enter your email" required>
                        <button type="button" onclick="initiatePayment()">Buy Now</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ====== Footer Section Start -->
    <footer class="wow fadeInUp relative z-10 bg-[#090E34] pt-20 lg:pt-[100px]" data-wow-delay=".15s">


        <div class="mt-12 border-t border-[#8890A4] border-opacity-40 py-8 lg:mt-[60px]">
            <div class="container">
                <div class="-mx-4 flex flex-wrap">
                    <div class="w-full px-4 md:w-2/3 lg:w-1/2">
                        <div class="my-1">
                            <div class="-mx-3 flex items-center justify-center md:justify-start">
                                <a href="https://rhinestone-naranja-bf4.notion.site/Privacy-Policy-14816a185b9e80b58318ecc3f3b267dc"
                                    class="px-3 text-base text-gray-7 hover:text-white hover:underline">
                                    Privacy policy
                                </a>
                                <a href="https://rhinestone-naranja-bf4.notion.site/Refund-Policy-14816a185b9e80a99da4c0ccf83d2ad2"
                                    class="px-3 text-base text-gray-7 hover:text-white hover:underline">
                                    Refund Policy
                                </a>
                                <a href="https://rhinestone-naranja-bf4.notion.site/Terms-Condition-14816a185b9e80f2a04de857c8bdff82"
                                    class="px-3 text-base text-gray-7 hover:text-white hover:underline">
                                    Terms of service
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="w-full px-4 md:w-1/3 lg:w-1/2">
                        <div class="my-1 flex justify-center md:justify-end">
                            <p class="text-base text-gray-7">
                                Copyright &copy; 2024/25, All Rights Reserved.

                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </footer>

    <!-- Razorpay Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        function initiatePayment() {
            const form = document.getElementById("paymentForm");
            const email = form.email.value;

            // Email validation
            if (!email) {
                alert("Email is required.");
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert("Please enter a valid email address.");
                return;
            }

            fetch('/create-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.message || "Failed to create order."); });
                    }
                    return response.json();
                })
                .then(data => {
                    // Validate the server response structure
                    if (!data || !data.order_id || !data.amount || !data.currency) {
                        throw new Error("Invalid response from server. Please try again.");
                    }

                    // Razorpay options
                    const options = {
                        key: "{{ razorpay_key_id }}",
                        amount: data.amount,
                        currency: data.currency,
                        order_id: data.order_id,
                        handler: function (response) {
                            // Handle successful payment
                            fetch('/payment-success', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    order_id: response.razorpay_order_id,
                                    payment_id: response.razorpay_payment_id,
                                    signature: response.razorpay_signature
                                })
                            })
                                .then(res => {
                                    if (!res.ok) {
                                        return res.json().then(err => { throw new Error(err.message || "Payment verification failed."); });
                                    }
                                    return res.json();
                                })
                                .then(res => {
                                    if (res.status === "success") {
                                        window.location.href = "/payment-success-page"; // Redirect to success page
                                    } else {
                                        throw new Error(res.message || "Payment verification failed.");
                                    }
                                })
                                .catch(err => {
                                    alert(err.message);
                                    window.location.href = "/payment-failed"; // Redirect to failed page
                                });
                        },
                        theme: {
                            color: "#3399cc" // Customization for Razorpay popup
                        }
                    };

                    const rzp = new Razorpay(options);
                    rzp.on('payment.failed', function (response) {
                        alert("Payment failed: " + response.error.description);
                        window.location.href = "/payment-failed"; // Redirect to failed page
                    });
                    rzp.open();
                })
                .catch(err => {
                    console.error(err);
                    alert(err.message || "An unexpected error occurred. Please try again.");
                });
        }
    </script>


</body>

</html>